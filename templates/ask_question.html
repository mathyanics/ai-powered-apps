{% extends "base.html" %}

{% block title %}Ask a Question - QnA with Datasets{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">Ask a Question about Your Dataset</h1>
        <p class="text-muted">Upload your dataset and ask questions!</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> Upload Dataset Files</h5>
            </div>
            <div class="card-body">
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="datasetFiles" class="form-label">
                            <i class="bi bi-file-earmark-arrow-up"></i> Select Dataset Files
                        </label>
                        <input type="file" class="form-control" id="datasetFiles" name="files[]" multiple accept=".csv,.xlsx,.json">
                        <div class="form-text">
                            <i class="bi bi-info-circle"></i> Supported formats: CSV, Excel (.xlsx), JSON | Max size: 16MB total
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-upload"></i> Upload Files
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="clearBtn">
                            <i class="bi bi-trash"></i> Clear Session
                        </button>
                    </div>
                </form>
                
                <div id="uploadedFiles" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="chatSection" style="display: none;">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-chat-dots"></i> Chat with Your Data</h5>
            </div>
            <div class="card-body">
                <div id="chatMessages" class="chat-container mb-3" style="height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px;">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> Hello! How can I help you with the dataset(s) above?
                    </div>
                </div>
                
                <form id="questionForm">
                    <div class="input-group">
                        <input type="text" class="form-control" id="questionInput" placeholder="Ask a question about your data... (Press Enter to send)" required autocomplete="off">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-send-fill"></i> Send
                        </button>
                    </div>
                    <small class="form-text text-muted mt-1">
                        <i class="bi bi-lightbulb"></i> Tip: Be specific with your questions for better results
                    </small>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="loadingSpinner" class="text-center mt-3" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Thinking...</p>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/ask_question.js') }}"></script>
{% endblock %}
